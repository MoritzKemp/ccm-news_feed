!function(){function e(){window.ccm[r].component(t)}var t={name:"news_feed",ccm:"https://akless.github.io/ccm/version/ccm-11.2.0.min.js",config:{css:["ccm.load","https://MoritzKemp.github.io/ccm-news_feed/style.css"],storeConfig:{store:"moritz_kemp_news_feed",url:"https://ccm.inf.h-brs.de"},store:"",user:{},enableOffline:"false",useOwnServiceWorker:"true",html:{inputArea:{tag:"div",class:"new-post-container",inner:[{tag:"form",class:"new-post-form",onsubmit:"%action%",inner:[{tag:"div",class:"new-post-input",inner:[{tag:"input",class:"new-post-title",type:"text",placeholder:"Title goes here ..."},{tag:"textarea",class:"new-post-text",rows:"3",placeholder:"Something really important ...   "}]},{tag:"input",class:"new-post-submit",type:"submit",disabled:"true"}]}]},postsArea:{tag:"div",class:"posts-area"},post:{tag:"div",class:"post",inner:[{tag:"div",class:"head",inner:[{tag:"div",class:"user",inner:[{tag:"div",class:"name",inner:"%user%"}]},{tag:"div",class:"title",inner:[{tag:"div",inner:"%title%"},{tag:"div",class:"date",inner:"%date%"}]},{tag:"div",class:"status-indicator",inner:[{tag:"div",class:"%status%"}]}]},{tag:"div",class:"content",inner:{tag:"div",inner:"%text%"}}]}}},Instance:function(){const e=this;let t={};this.ready=function(n){(t=e.ccm.helper.privatize(e)).user.addObserver("newsfeed",l),"serviceWorker"in navigator&&"true"===t.enableOffline&&("true"===t.useOwnServiceWorker&&navigator.serviceWorker.register("https://MoritzKemp.github.io/ccm-news_feed/serviceworker.js"),navigator.serviceWorker.addEventListener("message",p)),t.store=e.ccm.store(t.storeConfig),n&&n()},this.start=function(e){n(),t.store.get(s),navigator.serviceWorker.controller&&"true"===t.enableOffline&&navigator.serviceWorker.controller.postMessage({tag:"waiting-posts"}),e&&e()};const n=function(){let n=e.ccm.helper.html(t.html.inputArea,{action:a});e.element.appendChild(n)},s=function(n){let s=e.element.querySelector(".posts-area"),i=e.ccm.helper.html(t.html.postsArea);s?e.element.replaceChild(i,s):e.element.appendChild(i),n.forEach(r)},r=function(n,s=""){let r=e.element.querySelector(".posts-area"),i=e.ccm.helper.html(t.html.post,{title:n.title,date:n.date,user:n.user,text:n.text,status:s});r.firstChild?r.insertBefore(i,r.childNodes[0]):r.appendChild(i)},i=function(e){e.forEach(e=>{console.log(e);let t=new URL(e),n={};for(let e of t.searchParams.entries())n[e[0]]=e[1];r(n,"waiting")})},a=function(n){n.preventDefault();const s=e.element.querySelector(".new-post-text"),i=e.element.querySelector(".new-post-title"),a=s.value,l=i.value;s.value="",i.value="";const d={title:l,text:a,date:o(),user:t.user.data().name||""};"true"===t.enableOffline&&navigator.serviceWorker.controller?(r(d,"waiting"),c(d)):(r(d),t.store.set(d))},o=function(){let e=new Date,t=e.getDate(),n=e.getMonth(),s=e.getFullYear(),r=e.getHours(),i=e.getMinutes(),a=["Januar","Februar","MÃ¤rz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"];return t<10&&(t="0"+t),r<10&&(r="0"+r),i<10&&(i="0"+i),t+" "+a[n].substring(0,3)+". "+s+" "+r+":"+i},c=function(e){let n="",s=new URLSearchParams;s.append("store",t.storeConfig.store),s.append("dataset[title]",e.title),s.append("dataset[text]",e.text),s.append("dataset[date]",e.date),s.append("dataset[user]",e.user),s.append("dataset[key]",Math.floor(1e3*Math.random()+1)),n=t.storeConfig.url+"?"+s.toString(),console.log("Site controlled by: ",navigator.serviceWorker.controller),navigator.serviceWorker.controller.postMessage({request:n,tag:"new-post"})},l=function(t){e.element.querySelector(".new-post-submit").disabled=!t},d=function(){t.store.get(s)},p=function(e){switch(console.log("[News-feed] Msg from sw: ",e),e.data.tag){case"posts-shipped":d();break;case"waiting-posts":i(e.data.waitingPosts);break;default:console.log("No handler for sw-msg with tag: ",e.data.tag)}}}},n="ccm."+t.name+(t.version?"-"+t.version.join("."):"")+".js";if(window.ccm&&null===window.ccm.files[n])window.ccm.files[n]=t;else{var s=window.ccm&&window.ccm.components[t.name];s&&s.ccm&&(t.ccm=s.ccm),"string"==typeof t.ccm&&(t.ccm={url:t.ccm});var r=t.ccm.url.split("/").pop().split("-");if(r.length>1?((r=r[1].split(".")).pop(),"min"===r[r.length-1]&&r.pop(),r=r.join(".")):r="latest",window.ccm&&window.ccm[r])e();else{var i=document.createElement("script");document.head.appendChild(i),t.ccm.integrity&&i.setAttribute("integrity",t.ccm.integrity),t.ccm.crossorigin&&i.setAttribute("crossorigin",t.ccm.crossorigin),i.onload=function(){e(),document.head.removeChild(i)},i.src=t.ccm.url}}}();